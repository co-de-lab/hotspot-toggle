#!/usr/bin/env bash
set -euo pipefail

HOTSPOT_NAME="Hotspot"   # so heißt die NM-Verbindung standardmäßig

is_active() {
  nmcli -t -f NAME,TYPE,DEVICE connection show --active | grep -q "^${HOTSPOT_NAME}"
}

if is_active; then
  nmcli connection down "${HOTSPOT_NAME}"
  nmcli radio wifi off
  notify-send "Hotspot deaktiviert"
else
  # Falls Verbindung noch nicht existiert, versuch sie zu erstellen:
  nmcli radio wifi on
  nmcli connection up "${HOTSPOT_NAME}" 2>/dev/null || \
    nmcli dev wifi hotspot 

  # Docker-Chain öffnen (ohne Passwort dank sudoers-Zeile)
  sudo /usr/sbin/iptables -I DOCKER-USER -j ACCEPT || true

  notify-send "Hotspot aktiviert"
fi
